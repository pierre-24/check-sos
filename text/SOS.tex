\documentclass[12pt,a4paper]{article}
\usepackage[T1]{fontenc}
\usepackage[left=2cm, right=2cm, top=2cm, bottom=2cm]{geometry}
\usepackage{graphicx}
\usepackage{mathtools}
\usepackage{amssymb}
\usepackage{amsthm}
\usepackage{hyperref}
\usepackage{braket}
\usepackage{setspace}

\title{On sum over states (SOS)}
\author{Pierre Beaujean}
\begin{document}
\maketitle

\onehalfspacing

On the ground of perturbation theory, 
the SOS expression of Orr and Ward \cite{orrPerturbationTheoryNonlinear1971} (see also Bishop \cite{bishopExplicitNondivergentFormulas1994}) states that any component of any nonlinear optical tensor $\chi^{(n)}(-\omega_\sigma;\omega_1,\ldots)$ (of order $n$)\footnote{I'm aware that $\chi$ is generaly used to refer to the nonlinear susceptibility, the macroscopic equivalent of what I'm discussing here, but I needed a greek letter.} is given by:\begin{align}
&\chi^{(n)}_{\zeta\eta\ldots\nu}(-\omega_\sigma;\omega_1,\ldots) = \hbar^{-n+1}\sum_\mathcal{P}\sum_{a_1,a_2\ldots\,a_{n-1}} \frac{\mu^\zeta_{0a_1}{\mu}^\eta_{a_1a_2}\ldots \mu^\nu_{a_{n-1\,0}}}{\prod_{0<i<n} (\omega_{a_i}-\omega_\sigma+\sum_{0<j<i} \omega_j)},\label{eq:1:sos}
\end{align}
where $\zeta,\eta,\ldots$ are the Cartesian coordinates $x, y, z$ (in the molecular frame), $\omega_1, \omega_2\ldots$, the (optical) input frequencies of the laser for the NLO process (with $\omega_\sigma = \sum_{0<i<n} \omega_i$), $\ket{a_1}, \ket{a_2}, \ldots$, the states of the system  \textbf{including the ground state} (with $\hbar\omega_{a_i}$ the excitation energy from ground state, noted  $\ket{0}$, to $\ket{a_i}$), $\mu^\zeta_{a_ia_j} = \braket{a_i|\hat \zeta|a_j}$ the transition dipole moment from state $a_i$ to $a_j$ (it corresponds to the dipole moment of electronic state $a_i$ when $i=j$), and $\sum_\mathcal{P}$ the sum of the different permutations over each pair $(\zeta, \omega_\sigma),(\eta,\omega_1),\ldots$. Given the form of Eq.~\eqref{eq:1:sos}, it is relatively easy to write a (Python) code that compute any $\chi^{(n)}$.


\section{Avoiding divergences}

Examining the expressions more closely, one has:
\begin{align}
	\alpha_{ij}(-\omega;\omega) &= \hbar^{-1} \sum_\mathcal{P} \sum_{a_1} \frac{(\zeta\eta)_{a_1}}{\omega_{a_1} - \omega},\label{eq:sos:alpha}\\
	\beta_{ijk}(-\omega_\sigma; \omega_1, \omega_2) &= \hbar^{-2} \sum_\mathcal{P} \sum_{a_1,a_2} \frac{(\zeta\eta\kappa)_{a_1 a_2}}{(\omega_{a_1} - \omega_\sigma)(\omega_{a_2} - \omega_\sigma + \omega_1)},\label{eq:sos:beta}\\
	\gamma_{ijkl}(-\omega_\sigma; \omega_1, \omega_2, \omega_3) &= \hbar^{-3} \sum_\mathcal{P} \sum_{a_1, a_2, a_3} \frac{(\zeta\eta\kappa\lambda)_{a_1 a_2 a_3}}{(\omega_{a_1} - \omega_\sigma)(\omega_{a_2} - \omega_\sigma + \omega_1)(\omega_{a_3} - \omega_\sigma + \omega_1 + \omega_2)},\label{eq:sos:gamma}
\end{align}
representing the polarizability $\alpha = \chi^{(1)}$, first hyperpolarizability $\beta = \chi^{(2)}$, and second hyperpolarizability $\gamma = \chi^{(3)}$. Here, the numerator notation of Bishop \cite{bishopExplicitNondivergentFormulas1994}, $(\zeta\eta\kappa\lambda)_{a_1 a_2 a_3} = \mu_{0 a_1}^\zeta \mu_{a_1 a_2}^\eta \mu_{a_2 a_3}^\kappa \mu_{a_3 0}^\lambda$, is employed.

Each of Eqs.~\eqref{eq:sos:alpha}â€“\eqref{eq:sos:gamma} encounters divergences (or singularities) when a denominator vanishes. This phenomenon, termed \textbf{secular divergence} if caused by any state $\ket{a_i} = \ket{0}$ (and thus $\omega_{a_i} = 0$), can also arise if any optical frequency (or a combination thereof) matches $\omega_{a_i} \neq 0$, generally termed a \textbf{resonance} \cite{bishopExplicitNondivergentFormulas1994}. While resonances are intrinsic to perturbation theory and often mitigated by introducing damping factors (though methods remain debated \cite{campoPracticalModelFirst2012a}), secular divergences are mathematical artifacts and can be avoided. 

Following Bishops, substituting the dipole operator in Eq.~\eqref{eq:1:sos} with a fluctuation dipole operator, $\bar{\mu}^\zeta_{a_1 a_2} = \mu^\zeta_{a_1 a_2} - \delta_{a_1 a_2}\, \mu_{00}^\zeta$, results in $(\bar{\zeta})_g = 0$, allowing the ground state to be excluded from the summations in Eqs.~\eqref{eq:sos:alpha} and \eqref{eq:sos:beta}. Consequently, we obtain:
\begin{align}
	\alpha_{ij}(-\omega; \omega) &= \hbar^{-1} \sum_\mathcal{P} \sum_{a_1}{}' \frac{(\zeta\eta)_{a_1}}{\omega_{a_1} - \omega},\label{eq:fluct:alpha}\\
	\beta_{ijk}(-\omega_\sigma; \omega_1, \omega_2) &= \hbar^{-2} \sum_\mathcal{P} \sum_{a_1, a_2}{}' \frac{(\zeta\bar{\eta}\kappa)_{a_1 a_2}}{(\omega_{a_1} - \omega_\sigma)(\omega_{a_2} - \omega_\sigma + \omega_1)},\label{eq:fluct:beta}
\end{align}
where the prime indicates that the sums over $a_1$ (and $a_2$) now exclude $\ket{0}$. This adjustment removes secular divergence, permitting the first and last transition dipoles in each term to omit the ``bar'' as well.

Applying this procedure to Eq.~\eqref{eq:sos:gamma} introduces an error in cases where terms with $\ket{a_2} = \ket{0}$ are omitted. The correct expression for the second hyperpolarizability, $\gamma$, is therefore the sum of two components, $\gamma = \gamma^{(+)} + \gamma^{(-)}$, where:
\begin{align}
	\gamma_{ijkl}^{(+)}(-\omega_\sigma; \omega_1, \omega_2, \omega_3) &= \hbar^{-3} \sum_\mathcal{P} \sum_{a_1, a_2, a_3}{}' \frac{(\zeta \bar{\eta} \bar{\kappa} \lambda)_{a_1 a_2 a_3}}{(\omega_{a_1} - \omega_\sigma)(\omega_{a_2} - \omega_\sigma + \omega_1)(\omega_{a_3} - \omega_\sigma + \omega_1 + \omega_2)}, \nonumber\\
	\gamma_{ijkl}^{(-)}(-\omega_\sigma; \omega_1, \omega_2, \omega_3) &= \hbar^{-3} \sum_\mathcal{P} \sum_{a_1, a_3}{}' \frac{(\zeta \eta)_{a_1} (\kappa \lambda)_{a_3}}{(\omega_{a_1} - \omega_\sigma)(-\omega_\sigma + \omega_1)(\omega_{a_3} - \omega_\sigma + \omega_1 + \omega_2)},
\end{align}
where $\gamma^{(+)}$ corresponds to the expression when summing over all non-ground states, while $\gamma^{(-)}$ is a correction term, handling $\ket{a_2} = \ket{0}$. However, this (so-called) secular term $\gamma^{(-)}$ leads to divergence if the conditions $-\omega_\sigma + \omega_1 = \omega_2 + \omega_3 = 0$ is satisfied, even though the ground state is excluded from the summation.


	
\bibliographystyle{unsrt}
\bibliography{biblio}
	
\end{document}